// /app/api/heuristicfetch/route.ts
import { NextResponse } from 'next/server';
import { normalizeHeuristicShapes } from '../../lib/server/heuristicShapeMapper';
import { fetchNativeJson } from '../../lib/server/nativeClient';

const TIMEOUT_MS = 700;

export async function GET() {
  const rawShapes = await fetchNativeJson<unknown>({
    path: '/heuristic',
    timeoutMs: TIMEOUT_MS,
  });
  if (rawShapes == null) {
    return NextResponse.json(
      { error: 'Failed to fetch shapes' },
      { status: 500 }
    );
  }
  return NextResponse.json(normalizeHeuristicShapes(rawShapes), { status: 200 });
}
